

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Installation and Setup &mdash; Watershed Workflow 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Workflow library Concepts" href="concepts.html" />
    <link rel="prev" title="Gallery" href="gallery.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Watershed Workflow
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/mesh_coweeta.html">Example: mesh a delineated watershed</a></li>
<li class="toctree-l1"><a class="reference internal" href="gallery.html">Gallery</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recommended-process">Recommended process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-exodusii-optional">Installing ExodusII (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-rosetta-optional">Installing Rosetta (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-the-test-suite-optional">Run the test suite (optional)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Watershed Workflow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Installation and Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="installation-and-setup">
<h1>Installation and Setup<a class="headerlink" href="#installation-and-setup" title="Permalink to this headline">¶</a></h1>
<p>All code is in python3, though the dependencies (because of their need
for GIS libraries) can be tricky to get right.  It is recommended to
use Anaconda3 as a package manager, generating a unique environment
for use with this package, as this makes it fairly easy to get all the
required packages.</p>
<p>Note that this package is not currently installed in a typical
pythononic way (i.e. setuptools), but instead expects you to simply
use it in place.  This will change at some point.  In the meantime, to
install this package, simply place it and its third party libraries
(TPLs) in your python path:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /path/to/repository</span>
<span class="go">export PYTHONPATH=`pwd`:`pwd`/workflow_tpls:${PYTHONPATH}</span>
</pre></div>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Standard packages needed include <cite>argparse</cite> and <cite>subprocess</cite>, and for
testing, <cite>pytest</cite> and <cite>dist_utils</cite>.  Standard math packages include
<cite>numpy</cite>, <cite>matplotlib</cite>, and <cite>scipy</cite>.  Soil properties often come in
geodatabase files, which are best read with <cite>pandas</cite> and <cite>geopandas</cite>.</p>
<p>GIS work is typically done using expensive/closed source and GUI-based
tools.  For this work, we instead build on the extremely high-quality,
open-source packages for GIS in python: <cite>fiona</cite>, <cite>rasterio</cite>, <cite>shapely</cite>
and <cite>cartopy</cite>.</p>
<p><strong>Optional:</strong> Mesh generation of 2D, “map view” surface meshes uses
the open source library Triangle, which can be wrapped for python
using <cite>meshpy</cite>.  This in turn depends upon boost python.  Optionally,
extrusion of this 2D mesh into a 3D mesh for use in integrated
hydrologic models requires a 3D mesh library ~~ we tend to use
ExodusII here (though it would be straightforward to extend this to
other packages such as VTK).  ExodusII, part of the <a class="reference external" href="https://github.com/gsjaardema/seacas">SEACAS</a> suite of tools, provides a
python3 set of wrappers, but there is no current package, so this must
be installed separately.  See below.  Exodus, in turn, needs
<cite>netCDF4</cite>, which can be from conda.</p>
<p><strong>Optional:</strong> Finally, soil properties often come in percent
silt/clay/sand, yet hydrologic properties such as porosity,
permeability, and van Genuchten curves are the most frequently used in
models.  <a class="reference external" href="http://www.u.arizona.edu/~ygzhang/download.html">Rosetta3</a>
is a tool providing pedotransfer functions to convert these properties
into the needed model parameters.  There is no current package
available for this either, so it must be installed separately.  See
below.</p>
<p><strong>Optional:</strong> Here we use <cite>jupyter</cite> notebooks to provide examples and
illustrate usage of the package.  If you do not intend to use jupyter,
it is not necessary, adds a lot of extra packages, and can safely be
removed from the installation below.</p>
</div>
<div class="section" id="recommended-process">
<h2>Recommended process<a class="headerlink" href="#recommended-process" title="Permalink to this headline">¶</a></h2>
<p>Download and install <a class="reference external" href="https://www.anaconda.com/distribution/">Anaconda3</a>.  Then create a new
environment that includes the required packages:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Packages for general users</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda create -n watershed_workflow -c conda-forge -c defaults python=3 ipython ipykernel jupyter numpy matplotlib scipy pandas geopandas meshpy fiona rasterio shapely cartopy pyepsg descartes requests sortedcontainers attrs h5py netCDF4 pytest</span>
<span class="go">conda activate watershed_workflow</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Packages for developers and building documentation</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda create -n watershed_workflow -c conda-forge -c defaults python=3 ipython ipykernel jupyter numpy matplotlib scipy pandas geopandas meshpy fiona rasterio shapely cartopy pyepsg descartes requests sortedcontainers attrs h5py netCDF4 pytest sphinx=1.8.5 numpydoc sphinx_rtd_theme nbsphinx</span>
<span class="go">conda activate watershed_watershed_dev</span>
</pre></div>
</div>
</div>
<p>Note that, for OSX users, it is recommended you install <cite>python.app</cite>
as well, which ensures a framework python and makes matplotlib
plotting cleaner.  Solving this environment can take a few minutes.  A
current, complete, and tested conda environement for OSX is provided
in <cite>workflow_tpls/environment.yml</cite> and
<cite>workflow_tpls/environment_dev.yml</cite>.</p>
<p>Check your python installation:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python -c &#39;import numpy, matplotlib, scipy, rasterio, fiona, shapely, cartopy, meshpy.triangle; print(&quot;SUCCESS&quot;)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-exodusii-optional">
<h2>Installing ExodusII (optional)<a class="headerlink" href="#installing-exodusii-optional" title="Permalink to this headline">¶</a></h2>
<p>Clone the package from <a class="reference external" href="https://github.com/gsjaardema/seacas">source</a></p>
<p>Unfortunately this package does not do regular releases except as part
of the Trilinos project, and those releases are often somewhat old.
So we must build from master; the python3 wrappers are fairly new.
Edit the script at:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">workflow_tpls/configure-seacas.sh</span>
</pre></div>
</div>
<p>defining your compilers (likely clang if Mac and gcc if Linux) and
pointing to your SEACAS repo and Anaconda environment installation.</p>
<p>Hopefully you are then able to add your installed SEACAS to your
PYTHONPATH and import the python wrappers:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export PYTHONPATH=${SEACAS_DIR}/lib</span>
<span class="go">python -c &#39;import exodus3; print(&quot;SUCCESS&quot;)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-rosetta-optional">
<h2>Installing Rosetta (optional)<a class="headerlink" href="#installing-rosetta-optional" title="Permalink to this headline">¶</a></h2>
<p>Download the Rosetta-3.0beta-py3 package:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd workflow_tpls</span>
<span class="go">mkdir rosetta</span>
<span class="go">cd rosetta</span>
<span class="go">wget http://www.u.arizona.edu/~ygzhang/rosettav3/Rosetta-3.0beta-py3.tar.gz</span>
<span class="go">tar xzf Rosetta-3.0beta-py3.tar.gz</span>
</pre></div>
</div>
<p>This should be sufficient, check the installation:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python -c &#39;import rosetta.ANN_Module; print(&quot;SUCCESS&quot;)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Little is needed to set up the package, but likely you want to set a
data directory for storing all downloaded files.  Usually this is done
via exporting the WATERSHED_WORKFLOW_DIR environment variable to your
downloaded package directory, but it can also be placed arbitrarily in
your filesystem.</p>
<p>Then, each time you use Watershed Workflow, you must do the following
things (they may go in a bashrc or similar):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda activate watershed_workflow</span>
<span class="go">export SEACAS_DIR=/path/to/your/seacas  # optional!</span>
<span class="go">export WATERSHED_WORKFLOW_DIRECTORY=/path/to/your/watershed_workflow</span>
<span class="go">export PYTHONPATH=${WATERSHED_WORKFLOW_DIR}:${WATERSHED_WORKFLOW_DIR}/workflow_tpls:${SEACAS_DIR}/lib:${PYTHONPATH}</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-test-suite-optional">
<h2>Run the test suite (optional)<a class="headerlink" href="#run-the-test-suite-optional" title="Permalink to this headline">¶</a></h2>
<p>Given that you have activated your environment, set your PYTHONPATH,
and successfully install the above, the following tests should all
pass.  They are not all fast – some download files and may be
internet-connection-speed dependent.  You may be happy enough just
running the high-level tests:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pytest workflow/test/test_hilev.py</span>
</pre></div>
</div>
<p>but you can also run the entire suite:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pytest workflow</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="concepts.html" class="btn btn-neutral float-right" title="Workflow library Concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="gallery.html" class="btn btn-neutral float-left" title="Gallery" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, UT Battelle, Ethan Coon.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>