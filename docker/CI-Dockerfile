FROM continuumio/miniconda3 AS environ
#
# Stage 1 -- setup environment
#
LABEL Description="Watershed Workflow CI container for dependencies/TPLs and environment setup"

# set the workdir as the user's home directory
WORKDIR $GITHUB_WORKSPACE

# create an environment based on standard process -- yml not working?
#RUN conda create -n watershed_workflow -c conda-forge -c defaults python=3 ipython ipykernel jupyter notebook nb_conda_kernels nb_conda numpy matplotlib scipy pandas geopandas meshpy fiona rasterio shapely cartopy pyepsg descartes pyproj requests sortedcontainers attrs pip libarchive h5py netCDF4 pytest papermill

# create an environment based on yml file
RUN conda env create -f environment.yml && \
    conda clean -afy

CMD [ "python", "-c", "import fiona" ]
